<include>
  <template name="directory">
    <document type="freeswitch/xml">
      <xml-odbc-do name="query" on-zero-rows-break-to="not_found" value="
        SELECT
          dir_domains.id AS domain_id,
          dir_users.id AS user_id,
          dir_users.username,
          dir_users.cidr,
          dir_users.mailbox,
          dir_users.number-alias
        FROM
          dir_domains,
          dir_users
        WHERE
          dir_users.${key} = '${value}' AND
          dir_domains.name = '${domain_name}' AND
          dir_users.domain_id = dir_domains.id AND
          dir_users.enabled = 1;"/>
      <section name="directory">
        <domain name="${domain_name}">
          <params>
            <xml-odbc-do name="query" value="
              SELECT
                name, value
              FROM
                dir_domain_params
              WHERE
                dir_domain_id = '${domain_id}';">
              <param name="${name}" value="${value}"/>
            </xml-odbc-do>
          </params>
          <variables>
            <xml-odbc-do name="query" value="
              SELECT
                name, value
              FROM
                dir_domain_variables
              WHERE
                dir_domain_id = '${domain_id}';">
              <variable name="${name}" value="${value}"/>
            </xml-odbc-do>
          </variables>
          <groups>
            <group name="default">
              <users>
                <user id="${username}" mailbox="${mailbox}" cidr="${cidr}" number-alias="${number-alias}">
                  <params>
                    <xml-odbc-do name="query" on-zero-rows-break-to="not_found" value="
                      SELECT
                        name, value
                      FROM
                        dir_domain_params
                      WHERE
                        dir_domain_id = '${domain_id}';">
                      <param name="${name}" value="${value}"/>
                    </xml-odbc-do>
                  </params>
                  <variables>
                    <xml-odbc-do name="query" value="
                      SELECT
                        name, value
                      FROM
                        dir_domain_params
                      WHERE
                        dir_domain_id = '${domain_id}';">
                      <variable name="${name}" value="${value}"/>
                    </xml-odbc-do>
                  </variables>
                </user>
              </users>
            </group>
            <xml-odbc-do name="query" value="
              SELECT
                name AS group_name
              FROM
                dir_groups,
                dir_groups_users
              WHERE
                dir_groups_users.dir_group_id
                dir_user_id = '${user_id}';">
              <group name="${group_name}">
                <user id="${username}" type="pointer"/>
              </group>
            </xml-odbc-do>
          </groups>
        </domain>
      </section>
    </document>
  </template>
</include>
